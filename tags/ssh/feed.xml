<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>ssh on vUptime.io - Cloud builder(s)</title><link>vuptime.io/tags/ssh/</link><description>Recent content in ssh on vUptime.io - Cloud builder(s)</description><generator>Hugo -- gohugo.io</generator><copyright>Ludovic Rivallain and blog co-authors</copyright><lastBuildDate>Sun, 25 Jan 2015 00:00:00 +0000</lastBuildDate><atom:link href="vuptime.io/tags/ssh/feed.xml" rel="self" type="application/rss+xml"/><item><title>Nested VMware ESXi with virtualbox</title><link>vuptime.io/post/2015-01-25-nested-esxi-virtualbox/</link><pubDate>Sun, 25 Jan 2015 00:00:00 +0000</pubDate><guid>/2015/01/25/nested-esxi-virtualbox/</guid><description>
&lt;p>For testing cases it could be very useful to host a nested (= virtualized) VMware ESXi on your desk or laptop machine. For my own needs, I had to install an ESXi on virtualbox. Here is my tutorial.&lt;/p>
&lt;h1 id="installation">Installation&lt;/h1>
&lt;h2 id="prerequisites">Prerequisites&lt;/h2>
&lt;p>In order to install an ESXi 5.5 you'll have to provide:&lt;/p>
&lt;ul>
&lt;li>64-bit x86 processor with at least 2 cores&lt;/li>
&lt;li>4 GB of RAM (we'll see how to deal if you don't have/want to give 4GB of RAM to the nested ESXi)&lt;/li>
&lt;li>Intel-VT or AMD-V compatible processors&lt;/li>
&lt;li>1 GB of disk for system&lt;/li>
&lt;/ul>
&lt;p>In order to create small virtual machines for tests, you'll have to add more disk space, in a second device.&lt;/p>
&lt;p>You'll also need an ESXi iso file for installation.&lt;/p>
&lt;h2 id="esxi-virtual-machine-creation">ESXi Virtual Machine creation&lt;/h2>
&lt;p>In virtualbox, create a new virtual machine with following settings:&lt;/p>
&lt;ul>
&lt;li>Choose the name&lt;/li>
&lt;li>Type: Linux&lt;/li>
&lt;li>GuestOS: Other Linux (64-bit)&lt;/li>
&lt;li>Memory: &amp;gt;= 4GB (or less if necessary)&lt;/li>
&lt;li>Create a new virtual disk device&lt;/li>
&lt;li>Choose one of disk type choice (no big difference)&lt;/li>
&lt;li>Dynamic space allocation&lt;/li>
&lt;li>Size: 1GB&lt;/li>
&lt;/ul>
&lt;p>When virtual machine is created, edit settings to set 2 vCPU cores:&lt;/p>
&lt;figure>&lt;img src="vuptime.io/images/ESXiVirtualBox/ESXiVirtualBox01.png"/>&lt;figcaption>
&lt;h4>Edit VM CPU settings&lt;/h4>
&lt;/figcaption>
&lt;/figure>
&lt;p>Then mount the iso file to the DVD device:&lt;/p>
&lt;figure>&lt;img src="vuptime.io/images/ESXiVirtualBox/ESXiVirtualBox02.png"/>&lt;figcaption>
&lt;h4>Add ISO file to the virtual machine&lt;/h4>
&lt;/figcaption>
&lt;/figure>
&lt;p>Then you can edit the network settings (I need to use the existing local network so I used &amp;quot;bridged adapter&amp;quot; setting:&lt;/p>
&lt;figure>&lt;img src="vuptime.io/images/ESXiVirtualBox/ESXiVirtualBox03.png"/>&lt;figcaption>
&lt;h4>Change network adapter settings&lt;/h4>
&lt;/figcaption>
&lt;/figure>
&lt;p>Then save changes in configuration and start virtual machine.&lt;/p>
&lt;h2 id="esxi-installation-and-setup">ESXi installation and setup&lt;/h2>
&lt;p>ESXi installer will be automatically started on the virtual machine. During the process, installer will load some libraries and modules and check the available &amp;quot;hardware&amp;quot; on the virtual machine. According to the hardware settings, it could take some time before the first human action:&lt;/p>
&lt;figure>&lt;img src="vuptime.io/images/ESXiVirtualBox/ESXiVirtualBox04.png"/>&lt;figcaption>
&lt;h4>First human action in ESXi installation process&lt;/h4>
&lt;/figcaption>
&lt;/figure>
&lt;h3 id="optional-bypassing-the-minimal-requirements-check">(optional) Bypassing the minimal requirements check&lt;/h3>
&lt;p>If you give less than minimal requirements to your nested ESXi virtual machine. You'll we need to bypass the requirements checks to be able to install ESXi. To do so, open ESXi console by pressing [ALT]+[F1].&lt;/p>
&lt;p>Then login with &amp;quot;root&amp;quot; and no password:&lt;/p>
&lt;figure>&lt;img src="vuptime.io/images/ESXiVirtualBox/ESXiVirtualBox05.png"/>&lt;figcaption>
&lt;h4>Login to the ESXi console&lt;/h4>
&lt;/figcaption>
&lt;/figure>
&lt;p>When logged in:&lt;/p>
&lt;pre>&lt;code>$ cd /usr/lib/vmware/weasel/util
$ rm upgrade_precheck.pyc
$ mv upgrade_precheck.py upgrade_precheck.py.old
$ cp upgrade_precheck.py.old upgrade_precheck.py
$ vi upgrade_precheck.py
&lt;/code>&lt;/pre>
&lt;p>You'll need to find the following line (simple way is to type [ESC]+&lt;code>/MEM_MIN&lt;/code>):&lt;/p>
&lt;pre>&lt;code>MEM_MIN_SIZE = (4*1024) * SIZE_MiB
&lt;/code>&lt;/pre>
&lt;p>Change the &amp;quot;4&amp;quot; according to the number of GB you can give to your machine:&lt;/p>
&lt;figure>&lt;img src="vuptime.io/images/ESXiVirtualBox/ESXiVirtualBox06.png"/>&lt;figcaption>
&lt;h4>Bypassing min-memory check&lt;/h4>
&lt;/figcaption>
&lt;/figure>
&lt;p>Save file and exit: [ESC]+&lt;code>:wq!&lt;/code>&lt;/p>
&lt;p>Kill the installer process:&lt;/p>
&lt;pre>&lt;code>$ ps -c | grep weasel
$ kill â€“9 &amp;lt;PYTHON PROCESS ID&amp;gt;
&lt;/code>&lt;/pre>
&lt;p>Then go back to the installer mode: [ALT]+[F2]&lt;/p>
&lt;h3 id="back-to-the-installation">Back to the installation&lt;/h3>
&lt;ul>
&lt;li>Press [Enter] to start installation process.&lt;/li>
&lt;li>[F11] to accept EULA&lt;/li>
&lt;li>Select the vbox disk for system installation and press [Enter]:&lt;/li>
&lt;/ul>
&lt;figure>&lt;img src="vuptime.io/images/ESXiVirtualBox/ESXiVirtualBox07.png"/>&lt;figcaption>
&lt;h4>Select boot device&lt;/h4>
&lt;/figcaption>
&lt;/figure>
&lt;ul>
&lt;li>Select a keyboard layout according to your computer and press [Enter]&lt;/li>
&lt;li>Enter a password and confirm&lt;/li>
&lt;li>Then wait for hardware checking process&lt;/li>
&lt;li>Installer will warn you about one or more hardware settings but should let you finish the installation process by pressing [Enter]:&lt;/li>
&lt;/ul>
&lt;figure>&lt;img src="vuptime.io/images/ESXiVirtualBox/ESXiVirtualBox08.png"/>&lt;figcaption>
&lt;h4>Last step of installation process&lt;/h4>
&lt;/figcaption>
&lt;/figure>
&lt;ul>
&lt;li>Press [F11] to start installation on disk.&lt;/li>
&lt;/ul>
&lt;figure>&lt;img src="vuptime.io/images/ESXiVirtualBox/ESXiVirtualBox09.png"/>&lt;figcaption>
&lt;h4>Installation in progress&lt;/h4>
&lt;/figcaption>
&lt;/figure>
&lt;p>When ended, you can restart the virtual machine and enjoy your new ESXi installation.&lt;/p>
&lt;h1 id="customize-your-nested-esxi">Customize your nested ESXI&lt;/h1>
&lt;p>Following step are optional.&lt;/p>
&lt;h2 id="ip-settings">IP settings&lt;/h2>
&lt;p>If you use the bridge network adapter and don't have a DHCP server, you may have to set the IP settings to the ESXi:&lt;/p>
&lt;p>When ESXi is started, press [ALT]+[F2] to open &amp;quot;edit settings&amp;quot; panel and login:&lt;/p>
&lt;figure>&lt;img src="vuptime.io/images/ESXiVirtualBox/ESXiVirtualBox10.png"/>&lt;figcaption>
&lt;h4>Login to the ESXi console&lt;/h4>
&lt;/figcaption>
&lt;/figure>
&lt;p>Select &lt;code>Configure Management network&lt;/code>:&lt;/p>
&lt;figure>&lt;img src="vuptime.io/images/ESXiVirtualBox/ESXiVirtualBox12.png"/>&lt;figcaption>
&lt;h4>Configure management network&lt;/h4>
&lt;/figcaption>
&lt;/figure>
&lt;p>Edit IP settings according to your LAN or your needs:&lt;/p>
&lt;figure>&lt;img src="vuptime.io/images/ESXiVirtualBox/ESXiVirtualBox11.png"/>&lt;figcaption>
&lt;h4>Change IP settings&lt;/h4>
&lt;/figcaption>
&lt;/figure>
&lt;p>Once it's done, press [ESC] then [Y] to validate and apply changes.&lt;/p>
&lt;h2 id="ssh-server">SSH Server&lt;/h2>
&lt;p>To simplify the access to the ESXi command line tools, I use the embedded SSH server. To enable it:&lt;/p>
&lt;figure>&lt;img src="vuptime.io/images/ESXiVirtualBox/ESXiVirtualBox13.png"/>&lt;figcaption>
&lt;h4>Enable SSH server in troubleshooting options&lt;/h4>
&lt;/figcaption>
&lt;/figure>
&lt;p>Then enable SSH server by selecting &lt;code>Enable SSH&lt;/code> and pressing [Enter]:&lt;/p>
&lt;figure>&lt;img src="vuptime.io/images/ESXiVirtualBox/ESXiVirtualBox14.png"/>&lt;figcaption>
&lt;h4>Enable SSH server&lt;/h4>
&lt;/figcaption>
&lt;/figure>
&lt;p>Now you can login to your server by ssh:&lt;/p>
&lt;pre>&lt;code>$ ssh root@192.168.1.16
Password: **********
The time and date of this login have been sent to the system logs.
VMware offers supported, powerful system administration tools. Please
see www.vmware.com/go/sysadmintools for details.
The ESXi Shell can be disabled by an administrative user. See the
vSphere Security documentation for more information.
~ # hostname
NestedESXi55.lan
&lt;/code>&lt;/pre>
&lt;p>I prefer to use SSH key to login. To copy you public key to the ESXi server:&lt;/p>
&lt;pre>&lt;code>$ cat ~/.ssh/id_rsa.pub | ssh root@192.168.1.16 &amp;quot;cat - &amp;gt;&amp;gt; /etc/ssh/keys-root/authorized_keys&amp;quot;
Password: *********
&lt;/code>&lt;/pre>
&lt;p>Then you can check the correct behavior of login with SSH key:&lt;/p>
&lt;pre>&lt;code>$ssh root@192.168.1.16
The time and date of this login have been sent to the system logs.
VMware offers supported, powerful system administration tools. Please
see www.vmware.com/go/sysadmintools for details.
The ESXi Shell can be disabled by an administrative user. See the
vSphere Security documentation for more information.
~ # hostname
NestedESXi55.lan
&lt;/code>&lt;/pre>
&lt;h1 id="conclusion">Conclusion&lt;/h1>
&lt;p>Installing a nested VMware ESXi on virtualbox is an easy way to test commands or to get used to ESXi command line usage. As we can bypass the minimal requirements checks, you do not need a huge computer to run the famous enterprise-class, &lt;a href="https://en.wikipedia.org/wiki/Hypervisor#Classification" title="Hypervisor">type-1&lt;/a> &lt;a href="https://en.wikipedia.org/wiki/Hypervisor" title="Hypervisor">hypervisor&lt;/a>. But with this kind of configuration, you'll not be able to run several virtual-machines in good conditions.&lt;/p></description></item></channel></rss>