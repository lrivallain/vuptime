<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>keystone on vUptime.io - Cloud builder(s)</title><link>https://vuptime.io/tags/keystone/</link><description>Recent content in keystone on vUptime.io - Cloud builder(s)</description><generator>Hugo -- gohugo.io</generator><copyright>Ludovic Rivallain and blog co-authors</copyright><lastBuildDate>Tue, 10 Jan 2017 00:00:00 +0000</lastBuildDate><atom:link href="https://vuptime.io/tags/keystone/feed.xml" rel="self" type="application/rss+xml"/><item><title>Openstack - Migrate keystone endpoint URL</title><link>https://vuptime.io/post/2017-01-10-openstack-migrate-keystone-endpoint-url/</link><pubDate>Tue, 10 Jan 2017 00:00:00 +0000</pubDate><guid>https://vuptime.io/2017/01/10/openstack-migrate-keystone-endpoint-url/</guid><description>
&lt;p>After a DNS record change for the controller node of our lab OpenStack infrastructure, Horizon client was still displaying the old endpoint DNS hostname in the &lt;code>API access&lt;/code>.&lt;/p>
&lt;figure>&lt;img src="https://vuptime.io/images/MigrateOpenstackKeystoneUrl/before.png"/>&lt;figcaption>
&lt;h4>Old API access settings&lt;/h4>
&lt;/figcaption>
&lt;/figure>
&lt;p>This information is coming from the keystone database, so we need to proceed a c&lt;/p>
&lt;p>List endpoints list, filtered on interface &lt;code>public&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="ln"> 1&lt;/span>&lt;span class="cl">$ openstack endpoint list --interface public&lt;span class="s2">&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 2&lt;/span>&lt;span class="cl">&lt;span class="s2">+----------------------------------+-----------+--------------+--------------+---------+-----------+----------------------------------------------------------+
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 3&lt;/span>&lt;span class="cl">&lt;span class="s2">| ID | Region | Service Name | Service Type | Enabled | Interface | URL |
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 4&lt;/span>&lt;span class="cl">&lt;span class="s2">+----------------------------------+-----------+--------------+--------------+---------+-----------+----------------------------------------------------------+
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 5&lt;/span>&lt;span class="cl">&lt;span class="s2">| ********199a432b9da62586f978b2ee | RegionOne | glance | image | True | public | http://controller:9292 |
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 6&lt;/span>&lt;span class="cl">&lt;span class="s2">| ********de5b490d8d51b45dc1766999 | RegionOne | cinder | volume | True | public | http://controller:8776/v1/%(tenant_id)s |
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 7&lt;/span>&lt;span class="cl">&lt;span class="s2">| ********a042463397613d0304812f38 | RegionOne | cinderv2 | volumev2 | True | public | http://controller:8776/v2/%(tenant_id)s |
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 8&lt;/span>&lt;span class="cl">&lt;span class="s2">| ********a4e446169a4ff9f0e6865f54 | RegionOne | keystone | identity | True | public | http://controller:5000/v3 |
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 9&lt;/span>&lt;span class="cl">&lt;span class="s2">| ********8ce74fcd860f0f63000cf2f4 | RegionOne | swift | object-store | True | public | http://controller:8080/v1/AUTH_%(tenant_id)s |
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln">10&lt;/span>&lt;span class="cl">&lt;span class="s2">| ********1dcb42ac8f6592ae2c0aacab | RegionOne | neutron | network | True | public | http://controller:9696 |
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln">11&lt;/span>&lt;span class="cl">&lt;span class="s2">| ********b0ba4d6c87e4c20e18230a39 | RegionOne | nova | compute | True | public | http://controller:8774/v2.1/%(tenant_id)s |
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln">12&lt;/span>&lt;span class="cl">&lt;span class="s2">+----------------------------------+-----------+--------------+--------------+---------+-----------+----------------------------------------------------------+
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The same information from database side:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="ln"> 1&lt;/span>&lt;span class="cl">$ mysql keystone
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 2&lt;/span>&lt;span class="cl">MariaDB [keystone]&amp;gt; select id,url from keystone.endpoint where interface=&amp;#39;public&amp;#39; ;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 3&lt;/span>&lt;span class="cl">+----------------------------------+----------------------------------------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 4&lt;/span>&lt;span class="cl">| id | url |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 5&lt;/span>&lt;span class="cl">+----------------------------------+----------------------------------------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 6&lt;/span>&lt;span class="cl">| ********199a432b9da62586f978b2ee | http://controller:9292 |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 7&lt;/span>&lt;span class="cl">| ********de5b490d8d51b45dc1766999 | http://controller:8776/v1/%(tenant_id)s |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 8&lt;/span>&lt;span class="cl">| ********a042463397613d0304812f38 | http://controller:8776/v2/%(tenant_id)s |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 9&lt;/span>&lt;span class="cl">| ********a4e446169a4ff9f0e6865f54 | http://controller:5000/v3 |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln">10&lt;/span>&lt;span class="cl">| ********8ce74fcd860f0f63000cf2f4 | http://controller:8080/v1/AUTH_%(tenant_id)s |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln">11&lt;/span>&lt;span class="cl">| ********1dcb42ac8f6592ae2c0aacab | http://controller:9696 |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln">12&lt;/span>&lt;span class="cl">| ********b0ba4d6c87e4c20e18230a39 | http://controller:8774/v2.1/%(tenant_id)s |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln">13&lt;/span>&lt;span class="cl">+----------------------------------+----------------------------------------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln">14&lt;/span>&lt;span class="cl">7 rows in set (0.00 sec)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The query to change the endpoint url:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="ln">1&lt;/span>&lt;span class="cl">MariaDB [keystone]&amp;gt; update keystone.endpoint SET url = REPLACE(url, &amp;#39;controller&amp;#39;, &amp;#39;newurl.domain.tld&amp;#39;) WHERE interface=&amp;#39;public&amp;#39;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln">2&lt;/span>&lt;span class="cl">Query OK, 7 rows affected (0.00 sec)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln">3&lt;/span>&lt;span class="cl">Rows matched: 7 Changed: 7 Warnings: 0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>And the result:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="ln"> 1&lt;/span>&lt;span class="cl">MariaDB [keystone]&amp;gt; select id,url from keystone.endpoint where interface=&amp;#39;public&amp;#39; ;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 2&lt;/span>&lt;span class="cl">+----------------------------------+----------------------------------------------------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 3&lt;/span>&lt;span class="cl">| id | url |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 4&lt;/span>&lt;span class="cl">+----------------------------------+----------------------------------------------------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 5&lt;/span>&lt;span class="cl">| 30da1779199a432b9da62586f978b2ee | http://newurl.domain.tld:9292 |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 6&lt;/span>&lt;span class="cl">| 4b14eeb0de5b490d8d51b45dc1766999 | http://newurl.domain.tld:8776/v1/%(tenant_id)s |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 7&lt;/span>&lt;span class="cl">| 62fb579da042463397613d0304812f38 | http://newurl.domain.tld:8776/v2/%(tenant_id)s |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 8&lt;/span>&lt;span class="cl">| 976bf154a4e446169a4ff9f0e6865f54 | http://newurl.domain.tld:5000/v3 |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln"> 9&lt;/span>&lt;span class="cl">| c158b4718ce74fcd860f0f63000cf2f4 | http://newurl.domain.tld:8080/v1/AUTH_%(tenant_id)s |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln">10&lt;/span>&lt;span class="cl">| df0b3f6f1dcb42ac8f6592ae2c0aacab | http://newurl.domain.tld:9696 |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln">11&lt;/span>&lt;span class="cl">| ee2b5119b0ba4d6c87e4c20e18230a39 | http://newurl.domain.tld:8774/v2.1/%(tenant_id)s |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln">12&lt;/span>&lt;span class="cl">+----------------------------------+----------------------------------------------------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln">13&lt;/span>&lt;span class="cl">7 rows in set (0.00 sec)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>To apply the change, we restart memcached and keystone service:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="ln">1&lt;/span>&lt;span class="cl">service keystone restart
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="ln">2&lt;/span>&lt;span class="cl">service memcached restart
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Now the endpoint displayed from the horizon portal is updated with the new URL :&lt;/p>
&lt;figure>&lt;img src="https://vuptime.io/images/MigrateOpenstackKeystoneUrl/after.png"/>&lt;figcaption>
&lt;h4>New API access settings&lt;/h4>
&lt;/figcaption>
&lt;/figure></description></item></channel></rss>